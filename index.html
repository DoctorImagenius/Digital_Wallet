<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Wallet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap"
        rel="stylesheet">
    <!-- Favicon and PWA Meta Tags -->
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#4361ee">
    <meta name="apple-mobile-web-app-title" content="Digital Wallet">
    <meta name="application-name" content="Digital Wallet">
    <meta name="msapplication-TileColor" content="#4361ee">
    <meta name="theme-color" content="#4361ee">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- PWA Install Prompt -->
    <script>
        // PWA Install Prompt
        let deferredPrompt;
        const installButton = document.createElement('button');

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;

            // Create and show install button
            installButton.innerHTML = `
                <div style="position: fixed; bottom: 100px; right: 20px; z-index: 9999;">
                    <div style="background: linear-gradient(135deg, #4361ee, #3a56d4); 
                                color: white; padding: 12px 20px; border-radius: 30px; 
                                box-shadow: 0 4px 20px rgba(67, 97, 238, 0.4); 
                                display: flex; align-items: center; gap: 10px; 
                                cursor: pointer; font-weight: 600; font-size: 14px;">
                        <i class="fas fa-download"></i>
                        <span>Install App</span>
                    </div>
                </div>
            `;

            installButton.style.position = 'fixed';
            installButton.style.bottom = '100px';
            installButton.style.right = '20px';
            installButton.style.zIndex = '9999';
            installButton.style.border = 'none';
            installButton.style.background = 'none';
            installButton.style.cursor = 'pointer';

            // Only show on mobile devices
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                document.body.appendChild(installButton);

                installButton.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        // Show the install prompt
                        deferredPrompt.prompt();
                        // Wait for the user to respond to the prompt
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`User response to the install prompt: ${outcome}`);
                        // We've used the prompt, and can't use it again, discard it
                        deferredPrompt = null;
                        // Hide the install button
                        installButton.style.display = 'none';
                    }
                });

                // Hide the button after 10 seconds
                setTimeout(() => {
                    if (installButton.parentNode) {
                        installButton.style.display = 'none';
                    }
                }, 10000);
            }
        });

        // Track successful installation
        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
            if (installButton.parentNode) {
                installButton.style.display = 'none';
            }

            // Show welcome message
            setTimeout(() => {
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.ready.then(registration => {
                        registration.showNotification('Digital Wallet Installed!', {
                            body: 'Your identity wallet is now ready to use.',
                            icon: 'icons/android-chrome-192x192.png',
                            badge: 'icons/favicon-32x32.png',
                            vibrate: [200, 100, 200],
                            tag: 'install-notification'
                        });
                    });
                }
            }, 1000);
        });

        // Check if app is running in standalone mode
        function isRunningStandalone() {
            return window.matchMedia('(display-mode: standalone)').matches ||
                window.navigator.standalone ||
                document.referrer.includes('android-app://');
        }

        // If running in standalone mode, add special styling
        if (isRunningStandalone()) {
            document.documentElement.classList.add('standalone-mode');
        }
    </script>

    <!-- Service Worker Registration -->
    <script>
        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('sw.js').then(function (registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);

                    // Check for updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        console.log('Service worker update found!');

                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                console.log('New content is available; please refresh.');
                                // Show update notification
                                showUpdateNotification();
                            }
                        });
                    });
                }).catch(function (err) {
                    console.log('ServiceWorker registration failed: ', err);
                });

                // Check if page is controlled by a service worker
                if (navigator.serviceWorker.controller) {
                    console.log('This page is controlled by a service worker');
                }
            });

            // Listen for messages from service worker
            navigator.serviceWorker.addEventListener('message', event => {
                console.log('Message from service worker:', event.data);
                if (event.data && event.data.type === 'CACHE_UPDATED') {
                    showUpdateNotification();
                }
            });

            // Function to show update notification
            function showUpdateNotification() {
                const updateNotification = document.createElement('div');
                updateNotification.id = 'update-notification';
                updateNotification.innerHTML = `
                    <div style="position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); 
                                background: #333; color: white; padding: 15px 20px; border-radius: 10px; 
                                box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 9998;
                                display: flex; align-items: center; gap: 15px; max-width: 90%;">
                        <i class="fas fa-sync-alt" style="color: #4cc9f0;"></i>
                        <div>
                            <strong>Update Available</strong>
                            <p style="margin: 5px 0 0; font-size: 12px; opacity: 0.9;">New version is ready</p>
                        </div>
                        <button id="refresh-app" style="background: #4361ee; color: white; border: none; 
                                padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                            Refresh
                        </button>
                    </div>
                `;
                document.body.appendChild(updateNotification);

                document.getElementById('refresh-app').addEventListener('click', () => {
                    window.location.reload();
                });

                // Auto hide after 30 seconds
                setTimeout(() => {
                    if (updateNotification.parentNode) {
                        updateNotification.style.opacity = '0';
                        setTimeout(() => {
                            if (updateNotification.parentNode) {
                                updateNotification.parentNode.removeChild(updateNotification);
                            }
                        }, 500);
                    }
                }, 30000);
            }

            // Function to check for app updates
            function checkForUpdates() {
                if (navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({
                        type: 'CHECK_FOR_UPDATES'
                    });
                }
            }

            // Check for updates every hour
            setInterval(checkForUpdates, 3600000);

            // Also check when page gains focus
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    checkForUpdates();
                }
            });
        }
    </script>

    <!-- Existing CSS and Firebase imports continue below -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap"
        rel="stylesheet">

    <!-- Add these CSS styles for PWA -->
    <style>
        /* PWA Specific Styles */
        .standalone-mode .app-header {
            padding-top: env(safe-area-inset-top);
        }

        .standalone-mode .mobile-nav {
            padding-bottom: env(safe-area-inset-bottom);
        }

        .standalone-mode .add-document-btn {
            bottom: calc(90px + env(safe-area-inset-bottom));
        }

        /* Install Button Animation */
        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        #install-button-container {
            animation: pulse 2s infinite;
        }

        /* Update Notification Animation */
        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }

            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        #update-notification {
            animation: slideUp 0.5s ease-out;
        }

        /* iOS specific styles */
        @supports (-webkit-touch-callout: none) {
            .mobile-nav {
                padding-bottom: max(20px, env(safe-area-inset-bottom));
            }

            .auth-container {
                min-height: -webkit-fill-available;
            }

            body {
                min-height: -webkit-fill-available;
            }
        }

        /* Prevent text selection on PWA elements */
        .mobile-nav,
        .add-document-btn,
        #install-button-container {
            user-select: none;
            -webkit-user-select: none;
        }

        /* Better tap targets for mobile */
        @media (max-width: 767px) {
            .action-btn {
                min-height: 44px;
                /* Apple's recommended minimum tap target */
            }

            .nav-item {
                padding: 12px 0;
            }

            .btn {
                min-height: 44px;
            }
        }
    </style>













    <!-- Firebase SDK (Version 9 Modular) -->
    <script type="module">
        /*****************************************************************
         * FIREBASE SETUP INSTRUCTIONS - READ CAREFULLY
         *****************************************************************
         * 
         * SETUP PROJECT A (Authentication + Firestore)
         * 1. Go to https://console.firebase.google.com/
         * 2. Click "Create a project" → Name it "IdentityWallet-Auth"
         * 3. After creation, click "Web" icon (</>) to add web app
         * 4. Register app as "Identity Wallet Frontend"
         * 5. You'll get a firebaseConfig object - COPY IT
         * 6. Go to "Authentication" tab → Get Started → Enable "Email/Password"
         * 7. Go to "Firestore Database" tab → Create database → Start in production mode
         *    → Choose location closest to your users
         * 8. Apply these Firestore security rules:
         * 
         *    rules_version = '2';
         *    service cloud.firestore {
         *      match /databases/{database}/documents {
         *        match /users/{userId} {
         *          allow read, write: if request.auth != null && request.auth.uid == userId;
         *          match /documents/{documentId} {
         *            allow read, write: if request.auth != null && request.auth.uid == userId;
         *          }
         *        }
         *      }
         *    }
         * 
         * SETUP PROJECT B (Storage Only - EXISTING PROJECT)
         * 1. Use your EXISTING Firebase project with open storage rules
         * 2. Go to Project Settings → General → Your apps section
         * 3. Add another web app if needed → Name it "IdentityWallet-Storage"
         * 4. Copy its firebaseConfig separately
         * 
         * STORAGE RULES (Project B - Add this rule):
         *    rules_version = '2';
         *    service firebase.storage {
         *      match /b/{bucket}/o {
         *        match /identityWallet/users/{userId}/{allPaths=**} {
         *          allow read: if true;
         *          allow write: if request.auth != null && request.auth.uid == userId;
         *          allow delete: if request.auth != null && request.auth.uid == userId;
         *        }
         *      }
         *    }
         *****************************************************************/

        // Import Firebase modules
        import { initializeApp, deleteApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import {
            getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            deleteUser,
            updatePassword,
            reauthenticateWithCredential,
            EmailAuthProvider
        } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import {
            getFirestore,
            collection,
            addDoc,
            query,
            where,
            getDocs,
            deleteDoc,
            doc,
            Timestamp,
            orderBy,
            writeBatch,
            updateDoc
        } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import {
            getStorage,
            ref,
            uploadBytes,
            getDownloadURL,
            deleteObject,
            listAll
        } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";

        // ======================================================
        // FIREBASE CONFIGURATION - REPLACE WITH YOUR CONFIGS
        // ======================================================

        // PROJECT A CONFIG (Authentication + Firestore)
        const firebaseConfigProjectA = {
            apiKey: "AIzaSyDjtf1W-Td2rjJTMcIvPO0MKMnh6hKCwQU",
            authDomain: "identitywallet-auth.firebaseapp.com",
            projectId: "identitywallet-auth",
            storageBucket: "identitywallet-auth.firebasestorage.app",
            messagingSenderId: "121824533428",
            appId: "1:121824533428:web:438d3e0d88686c45f6f0e1"
        };

        // PROJECT B CONFIG (Storage only - EXISTING PROJECT)
        const firebaseConfigProjectB = {
            apiKey: "AIzaSyCLMVhHWK1of6T0ab4RCFKmn-AzJtTrbXc",
            authDomain: "imagenius1001-1bd3d.firebaseapp.com",
            projectId: "imagenius1001-1bd3d",
            storageBucket: "imagenius1001-1bd3d.appspot.com",
            messagingSenderId: "1076272573341",
            appId: "1:1076272573341:web:ee2ed4082aea23dccf5d74",
            measurementId: "G-488JRJ76B8"
        };

        // Initialize Firebase Project A (Auth + Firestore)
        const appA = initializeApp(firebaseConfigProjectA, "appA");
        const auth = getAuth(appA);
        const db = getFirestore(appA);

        // Initialize Firebase Project B (Storage only)
        const appB = initializeApp(firebaseConfigProjectB, "appB");
        const storage = getStorage(appB);

        // Make Firebase modules available globally
        window.firebaseModules = {
            auth, db, storage, appA, appB,
            authMethods: { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, deleteUser, updatePassword, reauthenticateWithCredential, EmailAuthProvider },
            firestoreMethods: { collection, addDoc, query, where, getDocs, deleteDoc, doc, Timestamp, orderBy, writeBatch, updateDoc },
            storageMethods: { ref, uploadBytes, getDownloadURL, deleteObject, listAll },
            appMethods: { deleteApp },
            firebaseConfigs: {
                projectA: firebaseConfigProjectA,
                projectB: firebaseConfigProjectB
            }
        };
    </script>
    <style>
        /* CSS Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --border-radius: 12px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        /* Dark Theme Variables */
        [data-theme="dark"] {
            --primary: #5a75ff;
            --primary-dark: #4a65e4;
            --secondary: #8a2be2;
            --success: #5cd9ff;
            --warning: #ffa726;
            --danger: #ff4081;
            --light: #2d3748;
            --dark: #f8f9fa;
            --gray: #a0aec0;
            --light-gray: #4a5568;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        body {
            background-color: #f5f7ff;
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 80px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        [data-theme="dark"] body {
            background-color: #1a202c;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Authentication Screens */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7ff 0%, #e3e9ff 100%);
            transition: background 0.3s ease;
        }

        [data-theme="dark"] .auth-container {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
        }

        .auth-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 100%;
            max-width: 400px;
            padding: 40px 30px;
            animation: fadeIn 0.5s ease;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        [data-theme="dark"] .auth-card {
            background: #2d3748;
            border: 1px solid #4a5568;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h1 {
            color: var(--primary);
            font-size: 28px;
            margin-bottom: 5px;
        }

        .auth-header p {
            color: var(--gray);
            font-size: 15px;
        }

        .auth-logo {
            font-size: 42px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
            background-color: #fcfcff;
            color: var(--dark);
        }

        [data-theme="dark"] .form-control {
            background-color: #4a5568;
            border-color: #718096;
            color: #f8f9fa;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        [data-theme="dark"] .form-control:focus {
            box-shadow: 0 0 0 3px rgba(90, 117, 255, 0.3);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 14px 24px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            min-height: 52px;
        }

        .btn:hover:not(:disabled) {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(67, 97, 238, 0.2);
        }

        [data-theme="dark"] .btn:hover:not(:disabled) {
            box-shadow: 0 6px 12px rgba(90, 117, 255, 0.3);
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-full {
            width: 100%;
        }

        .btn-secondary {
            background-color: var(--secondary);
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: #5a08a0;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover:not(:disabled) {
            background-color: #d11465;
        }

        .btn-success {
            background-color: #4CAF50;
        }

        .btn-success:hover:not(:disabled) {
            background-color: #3d8b40;
        }

        .btn-warning {
            background-color: var(--warning);
        }

        .btn-warning:hover:not(:disabled) {
            background-color: #d87e16;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            min-height: auto;
        }

        /* Loading spinner inside buttons */
        .btn-loading {
            position: relative;
            color: transparent !important;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .auth-footer {
            margin-top: 25px;
            text-align: center;
            font-size: 14px;
            color: var(--gray);
        }

        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        .error-message {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--danger);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
            border: 1px solid rgba(247, 37, 133, 0.2);
        }

        .success-message {
            background-color: rgba(76, 201, 240, 0.1);
            color: var(--success);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
            border: 1px solid rgba(76, 201, 240, 0.2);
        }

        /* Theme Toggle - Professional Design */
        .theme-switch {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .theme-switch-text {
            color: var(--gray);
            font-size: 14px;
            font-weight: 500;
            display: none;
        }

        @media (min-width: 768px) {
            .theme-switch-text {
                display: block;
            }
        }

        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .theme-toggle-input {
            display: none;
        }

        .theme-toggle-label {
            display: block;
            width: 100%;
            height: 100%;
            background: var(--light-gray);
            border-radius: 30px;
            position: relative;
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-toggle-label:before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 12px;
            color: var(--primary);
        }

        [data-theme="light"] .theme-toggle-label:before {
            content: '\f185';
            transform: translateX(0);
        }

        [data-theme="dark"] .theme-toggle-label:before {
            content: '\f186';
            transform: translateX(30px);
            background: #4a5568;
            color: #fbbf24;
        }

        [data-theme="dark"] .theme-toggle-label {
            background: #4a5568;
        }

        /* App Header */
        .app-header {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        [data-theme="dark"] .app-header {
            background: #2d3748;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            font-size: 24px;
            color: var(--primary);
        }

        .logo-text {
            font-weight: 700;
            font-size: 20px;
            color: var(--dark);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .desktop-nav {
            display: flex;
            gap: 20px;
            margin-left: 30px;
        }

        .desktop-nav-item {
            padding: 8px 16px;
            text-decoration: none;
            color: var(--gray);
            border-radius: 6px;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .desktop-nav-item:hover,
        .desktop-nav-item.active {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        [data-theme="dark"] .desktop-nav-item:hover,
        [data-theme="dark"] .desktop-nav-item.active {
            background-color: rgba(90, 117, 255, 0.2);
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 20px;
            cursor: pointer;
            transition: var(--transition);
            padding: 8px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logout-btn:hover {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--danger);
        }

        .desktop-logout-btn {
            display: flex;
        }

        .mobile-logout-btn {
            display: none;
        }

        /* Dashboard */
        .dashboard {
            padding: 20px;
        }

        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .dashboard-header p {
            color: var(--gray);
            font-size: 15px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
        }

        [data-theme="dark"] .stat-card {
            background: #2d3748;
            border: 1px solid #4a5568;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .stat-icon.active {
            background-color: rgba(76, 201, 240, 0.2);
            color: var(--success);
        }

        .stat-icon.expiring {
            background-color: rgba(248, 150, 30, 0.2);
            color: var(--warning);
        }

        .stat-icon.expired {
            background-color: rgba(247, 37, 133, 0.2);
            color: var(--danger);
        }

        .stat-info h3 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .stat-info p {
            font-size: 14px;
            color: var(--gray);
        }

        /* Document Cards */
        .documents-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .document-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            height: 100%;
            display: flex;
            flex-direction: column;
            opacity: 1;
            transform: translateY(0);
        }

        [data-theme="dark"] .document-card {
            background: #2d3748;
            border: 1px solid #4a5568;
        }

        .document-card.fade-out {
            opacity: 0;
            transform: translateY(20px);
        }

        .document-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .document-card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .document-card.expiring {
            border-left: 5px solid var(--warning);
        }

        .document-card.expired {
            border-left: 5px solid var(--danger);
        }

        .document-image {
            height: 180px;
            overflow: hidden;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
        }

        [data-theme="dark"] .document-image {
            background-color: #4a5568;
        }

        .document-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .document-card:hover .document-image img {
            transform: scale(1.05);
        }

        .document-placeholder {
            font-size: 50px;
            color: var(--light-gray);
        }

        .document-info {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .document-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .document-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
            word-break: break-word;
        }

        .document-category {
            display: inline-block;
            padding: 4px 10px;
            background-color: var(--light-gray);
            color: var(--gray);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .document-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background-color: rgba(76, 201, 240, 0.2);
            color: var(--success);
        }

        .status-expiring {
            background-color: rgba(248, 150, 30, 0.2);
            color: var(--warning);
        }

        .status-expired {
            background-color: rgba(247, 37, 133, 0.2);
            color: var(--danger);
        }

        .document-dates {
            margin-top: auto;
        }

        .date-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .date-label {
            color: var(--gray);
        }

        .date-value {
            font-weight: 500;
            text-align: right;
            max-width: 60%;
            word-break: break-word;
            color: var(--dark);
        }

        .document-actions {
            display: flex;
            border-top: 1px solid var(--light-gray);
            background-color: #fcfcff;
        }

        [data-theme="dark"] .document-actions {
            background-color: #4a5568;
            border-top-color: #718096;
        }

        .action-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: var(--gray);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: auto;
        }

        .action-btn:hover {
            background-color: rgba(67, 97, 238, 0.05);
            color: var(--primary);
        }

        [data-theme="dark"] .action-btn:hover {
            background-color: rgba(90, 117, 255, 0.1);
        }

        .action-btn.edit:hover {
            color: var(--success);
        }

        .action-btn.delete:hover {
            color: var(--danger);
        }

        /* Upload Document Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(30px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        [data-theme="dark"] .modal {
            background: #2d3748;
            border: 1px solid #4a5568;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-header {
            padding: 25px 30px 15px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 22px;
            color: var(--dark);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--dark);
        }

        [data-theme="dark"] .close-modal:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .modal-body {
            padding: 25px 30px;
        }

        .file-upload-area {
            border: 2px dashed var(--light-gray);
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 25px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.02);
        }

        [data-theme="dark"] .file-upload-area:hover {
            background-color: rgba(90, 117, 255, 0.05);
        }

        .file-upload-area.drag-over {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.05);
        }

        .file-upload-area i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .file-upload-area p {
            color: var(--gray);
            margin-bottom: 10px;
        }

        .file-upload-area .file-name {
            color: var(--primary);
            font-weight: 500;
            margin-top: 10px;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .preview-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
            object-fit: contain;
        }

        /* Notification Banner */
        .notification-banner {
            background: linear-gradient(90deg, #f8961e, #f9c74f);
            color: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin: 25px 0px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideDown 0.5s ease;
            display: none;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification-text h4 {
            font-size: 16px;
            margin-bottom: 3px;
        }

        .notification-text p {
            font-size: 14px;
            opacity: 0.9;
        }

        .close-notification {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: var(--transition);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-notification:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state i {
            font-size: 80px;
            color: var(--light-gray);
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 22px;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .empty-state p {
            color: var(--gray);
            margin-bottom: 30px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Mobile Navigation */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            z-index: 200;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        [data-theme="dark"] .mobile-nav {
            background: #2d3748;
            box-shadow: 0 -2px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--gray);
            transition: var(--transition);
            flex: 1;
            padding: 5px 0;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item i {
            font-size: 22px;
            margin-bottom: 5px;
        }

        .nav-item span {
            font-size: 12px;
            font-weight: 500;
        }

        .nav-item:hover {
            color: var(--primary);
        }

        .add-document-btn {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            border: none;
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
            font-size: 24px;
            cursor: pointer;
            z-index: 150;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        [data-theme="dark"] .add-document-btn {
            box-shadow: 0 6px 20px rgba(90, 117, 255, 0.4);
        }

        .add-document-btn:hover {
            background-color: var(--primary-dark);
            transform: scale(1.1);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 4px solid rgba(67, 97, 238, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin: 30px auto;
            display: block;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            background-color: var(--light-gray);
            border-radius: 20px;
            margin: 15px 0;
            display: none;
            height: 8px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            border-radius: 20px;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Profile Section */
        .profile-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            display: none;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        [data-theme="dark"] .profile-section {
            background: #2d3748;
            border: 1px solid #4a5568;
        }

        .profile-section.active {
            display: block;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            flex-shrink: 0;
        }

        @media (max-width: 767px) {
            .profile-header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .profile-avatar {
                width: 70px;
                height: 70px;
                font-size: 28px;
            }

            .profile-info h2 {
                font-size: 20px;
                text-align: center;
            }

            .profile-info p {
                text-align: center;
            }
        }

        .profile-info h2 {
            font-size: 24px;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .profile-info p {
            color: var(--gray);
            font-size: 14px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .profile-stat {
            background-color: var(--light);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            transition: background-color 0.3s ease;
        }

        [data-theme="dark"] .profile-stat {
            background-color: #4a5568;
        }

        .profile-stat h3 {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .profile-stat p {
            color: var(--gray);
            font-size: 14px;
        }

        /* Password Change Section */
        .password-change-section {
            background-color: rgba(67, 97, 238, 0.05);
            border: 1px solid rgba(67, 97, 238, 0.1);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        [data-theme="dark"] .password-change-section {
            background-color: rgba(90, 117, 255, 0.1);
            border-color: rgba(90, 117, 255, 0.2);
        }

        .password-change-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .danger-zone {
            background-color: rgba(247, 37, 133, 0.05);
            border: 1px solid rgba(247, 37, 133, 0.2);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 30px;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        [data-theme="dark"] .danger-zone {
            background-color: rgba(247, 37, 133, 0.1);
            border-color: rgba(247, 37, 133, 0.3);
        }

        .danger-zone h3 {
            color: var(--danger);
            margin-bottom: 10px;
            font-size: 18px;
        }

        .danger-zone p {
            color: var(--gray);
            margin-bottom: 15px;
            font-size: 14px;
        }

        /* View Document Modal */
        #view-modal .modal {
            max-width: 700px;
        }

        #view-modal .modal-body {
            text-align: center;
        }

        #fullscreen-image {
            max-width: 100%;
            max-height: 500px;
            border-radius: 8px;
            margin-bottom: 20px;
            object-fit: contain;
            background-color: #f8f9fa;
            padding: 10px;
            transition: background-color 0.3s ease;
        }

        [data-theme="dark"] #fullscreen-image {
            background-color: #4a5568;
        }

        /* Toast Notification */
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 400px;
            z-index: 2000;
            transform: translateX(150%);
            transition: transform 0.4s ease;
        }

        [data-theme="dark"] .toast-notification {
            background: #2d3748;
            border: 1px solid #4a5568;
        }

        .toast-notification.show {
            transform: translateX(0);
        }

        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .toast-icon.success {
            background-color: rgba(76, 201, 240, 0.2);
            color: var(--success);
        }

        .toast-icon.error {
            background-color: rgba(247, 37, 133, 0.2);
            color: var(--danger);
        }

        .toast-icon.warning {
            background-color: rgba(248, 150, 30, 0.2);
            color: var(--warning);
        }

        .toast-content {
            flex: 1;
        }

        .toast-content h4 {
            font-size: 16px;
            margin-bottom: 3px;
            color: var(--dark);
        }

        .toast-content p {
            font-size: 14px;
            color: var(--gray);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .toast-close:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] .toast-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Edit Document Modal */
        #edit-modal .modal {
            max-width: 500px;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideDown {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .dashboard {
                padding: 30px;
            }

            .mobile-nav {
                display: none;
            }

            body {
                padding-bottom: 0;
            }

            .add-document-btn {
                bottom: 30px;
                right: 30px;
            }

            .documents-container {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            }

            .desktop-logout-btn {
                display: flex;
            }

            .mobile-logout-btn {
                display: none;
            }
        }

        @media (max-width: 767px) {
            .desktop-nav {
                display: none;
            }

            .desktop-logout-btn {
                display: none;
            }

            .mobile-logout-btn {
                display: flex;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }

            .header-content {
                padding: 15px 20px;
            }

            .auth-card {
                padding: 30px 20px;
            }

            .profile-section {
                padding: 20px;
            }

            .theme-switch {
                margin-left: 0;
            }

            .theme-switch-text {
                display: none;
            }

            .document-actions {
                flex-wrap: wrap;
            }

            .action-btn {
                flex: 0 0 50%;
                padding: 12px;
                font-size: 14px;
            }
        }

        @media (min-width: 1024px) {
            .container {
                padding: 0 40px;
            }

            .documents-container {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }

            .dashboard-header h1 {
                font-size: 28px;
            }
        }
    </style>
</head>

<body>
    <!-- Toast Notification Container -->
    <div id="toast-container"></div>

    <!-- Authentication Screens -->
    <div id="auth-container" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="auth-logo">
                    <i class="fas fa-id-card"></i>
                </div>
                <h1>Digital Wallet</h1>
                <p>Store and manage your digital identities securely</p>
            </div>

            <div id="error-message" class="error-message"></div>
            <div id="success-message" class="success-message"></div>

            <!-- Sign Up Form -->
            <form id="signup-form">
                <div class="form-group">
                    <label for="signup-email">Email Address</label>
                    <input type="email" id="signup-email" class="form-control" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" class="form-control"
                        placeholder="Create a strong password (min. 6 characters)" minlength="6" required>
                </div>
                <div class="form-group">
                    <label for="signup-confirm-password">Confirm Password</label>
                    <input type="password" id="signup-confirm-password" class="form-control"
                        placeholder="Confirm your password" minlength="6" required>
                </div>
                <button type="submit" class="btn btn-full" id="signup-btn">
                    <span>Create Account</span>
                </button>
                <div class="auth-footer">
                    Already have an account? <a href="#" id="show-login">Sign In</a>
                </div>
            </form>

            <!-- Login Form -->
            <form id="login-form" style="display: none;">
                <div class="form-group">
                    <label for="login-email">Email Address</label>
                    <input type="email" id="login-email" class="form-control" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" class="form-control" placeholder="Enter your password"
                        required>
                </div>
                <button type="submit" class="btn btn-full" id="login-btn">
                    <span>Sign In</span>
                </button>
                <div class="auth-footer">
                    Don't have an account? <a href="#" id="show-signup">Create Account</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App (hidden initially) -->
    <div id="app-container" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <div class="logo-icon">
                            <i class="fas fa-id-card"></i>
                        </div>
                        <div class="logo-text">Digital Wallet</div>
                        <nav class="desktop-nav">
                            <a href="#" class="desktop-nav-item active" data-view="dashboard">
                                <i class="fas fa-home"></i>
                                <span>Dashboard</span>
                            </a>
                            <a href="#" class="desktop-nav-item" data-view="expiring">
                                <i class="fas fa-clock"></i>
                                <span>Expiring</span>
                            </a>
                            <a href="#" class="desktop-nav-item" data-view="profile">
                                <i class="fas fa-user"></i>
                                <span>Profile</span>
                            </a>
                        </nav>
                    </div>
                    <div class="header-controls">
                        <div class="theme-switch">
                            <span class="theme-switch-text">Theme</span>
                            <div class="theme-toggle">
                                <input type="checkbox" id="theme-toggle-input" class="theme-toggle-input">
                                <label for="theme-toggle-input" class="theme-toggle-label"></label>
                            </div>
                        </div>
                        <div class="user-menu">
                            <div class="user-avatar" id="user-avatar" title="View Profile">U</div>
                            <button class="logout-btn desktop-logout-btn" id="desktop-logout-btn" title="Logout">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Notification Banner -->
        <div class="container">
            <div id="notification-banner" class="notification-banner">
                <div class="notification-content">
                    <div class="notification-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="notification-text">
                        <h4>Documents Expiring Soon</h4>
                        <p id="notification-text">You have <span id="expiring-count">0</span> documents expiring soon.
                            Check them now!</p>
                    </div>
                </div>
                <button class="close-notification" id="close-notification">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="dashboard">
            <div class="container">
                <!-- Dashboard View -->
                <div id="dashboard-view">
                    <div class="dashboard-header">
                        <h1>My Identity Documents</h1>
                        <p>Securely store and manage your important documents</p>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-container" id="stats-container">
                        <div class="stat-card">
                            <div class="stat-icon active">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="active-count">0</h3>
                                <p>Active Documents</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon expiring">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="expiring-count-stat">0</h3>
                                <p>Expiring Soon</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon expired">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="expired-count">0</h3>
                                <p>Expired Documents</p>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Grid -->
                    <div id="documents-grid" class="documents-container">
                        <!-- Documents will be loaded here dynamically -->
                    </div>

                    <!-- Loading Spinner -->
                    <div id="loading-spinner" class="loading-spinner" style="display: none;"></div>

                    <!-- Empty State -->
                    <div id="empty-state" class="empty-state" style="display: none;">
                        <i class="fas fa-id-card"></i>
                        <h3>No Documents Added Yet</h3>
                        <p>Start by adding your first identity document like passport, driver's license, or any ID card.
                        </p>
                        <button class="btn" id="add-first-document">
                            <span>Add Your First Document</span>
                        </button>
                    </div>
                </div>

                <!-- Profile View -->
                <div id="profile-view" class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profile-avatar">U</div>
                        <div class="profile-info">
                            <h2 id="profile-email">User Email</h2>
                            <p id="profile-join-date">Joined on loading...</p>
                        </div>
                    </div>

                    <div class="profile-stats">
                        <div class="profile-stat">
                            <h3 id="profile-total-docs">0</h3>
                            <p>Total Documents</p>
                        </div>
                        <div class="profile-stat">
                            <h3 id="profile-active-docs">0</h3>
                            <p>Active Documents</p>
                        </div>
                        <div class="profile-stat">
                            <h3 id="profile-expiring-docs">0</h3>
                            <p>Expiring Soon</p>
                        </div>
                        <div class="profile-stat">
                            <h3 id="profile-expired-docs">0</h3>
                            <p>Expired Documents</p>
                        </div>
                    </div>

                    <!-- Password Change Section -->
                    <div class="password-change-section">
                        <h3>
                            <i class="fas fa-key"></i>
                            Change Password
                        </h3>
                        <form id="change-password-form">
                            <div class="form-group">
                                <label for="current-password">Current Password</label>
                                <input type="password" id="current-password" class="form-control"
                                    placeholder="Enter your current password" required>
                            </div>
                            <div class="form-group">
                                <label for="new-password">New Password</label>
                                <input type="password" id="new-password" class="form-control"
                                    placeholder="Enter new password (min. 6 characters)" minlength="6" required>
                            </div>
                            <div class="form-group">
                                <label for="confirm-new-password">Confirm New Password</label>
                                <input type="password" id="confirm-new-password" class="form-control"
                                    placeholder="Confirm new password" minlength="6" required>
                            </div>
                            <button type="submit" class="btn btn-secondary" id="change-password-btn">
                                <i class="fas fa-save"></i>
                                <span>Update Password</span>
                            </button>
                        </form>
                    </div>

                    <div class="danger-zone">
                        <h3>Danger Zone</h3>
                        <p>Deleting your account will permanently remove all your documents and data. This action cannot
                            be undone.</p>
                        <button class="btn btn-danger" id="delete-account-btn">
                            <i class="fas fa-trash"></i>
                            <span>Delete My Account</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Floating Action Button -->
        <button class="add-document-btn" id="add-document-btn">
            <i class="fas fa-plus"></i>
        </button>

        <!-- Mobile Navigation -->
        <nav class="mobile-nav">
            <a href="#" class="nav-item active" data-view="dashboard">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-view="expiring">
                <i class="fas fa-clock"></i>
                <span>Expiring</span>
            </a>
            <a href="#" class="nav-item" data-view="profile">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
            <a href="#" class="nav-item mobile-logout-btn" id="mobile-logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </nav>
    </div>

    <!-- Upload Document Modal -->
    <div id="upload-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>Add New Document</h2>
                <button class="close-modal" id="close-upload-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="document-upload-form">
                    <div class="form-group">
                        <label for="document-title">Document Title *</label>
                        <input type="text" id="document-title" class="form-control"
                            placeholder="e.g. Passport, Driver's License" required>
                    </div>

                    <div class="form-group">
                        <label for="document-category">Category *</label>
                        <select id="document-category" class="form-control" required>
                            <option value="">Select Category</option>
                            <option value="ID">ID Card</option>
                            <option value="Passport">Passport</option>
                            <option value="Driver's License">Driver's License</option>
                            <option value="Education">Education</option>
                            <option value="Vehicle">Vehicle</option>
                            <option value="Office">Office</option>
                            <option value="Insurance">Insurance</option>
                            <option value="Medical">Medical</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="expiry-date">Expiry Date *</label>
                        <input type="date" id="expiry-date" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="reminder-date">Reminder Date *</label>
                        <input type="date" id="reminder-date" class="form-control" required>
                        <small style="color: var(--gray); margin-top: 5px; display: block;">You'll be notified on this
                            date</small>
                    </div>

                    <div class="form-group">
                        <label>Upload Document Image *</label>
                        <div class="file-upload-area" id="file-upload-area">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload or drag and drop</p>
                            <p>PNG, JPG, JPEG up to 5MB</p>
                            <div class="file-name" id="file-name">No file selected</div>
                            <img id="image-preview" class="preview-image" src="" alt="Preview">
                            <input type="file" id="document-image" accept="image/*" style="display: none;" required>
                        </div>
                        <!-- Upload Progress Bar -->
                        <div class="progress-container" id="upload-progress">
                            <div class="progress-bar" id="progress-bar"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn btn-full" id="upload-document-btn">
                            <i class="fas fa-upload"></i>
                            <span>Upload Document</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Document Modal -->
    <div id="edit-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>Edit Document</h2>
                <button class="close-modal" id="close-edit-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="document-edit-form">
                    <input type="hidden" id="edit-document-id">
                    <input type="hidden" id="edit-document-storage-path">

                    <div class="form-group">
                        <label for="edit-document-title">Document Title *</label>
                        <input type="text" id="edit-document-title" class="form-control"
                            placeholder="e.g. Passport, Driver's License" required>
                    </div>

                    <div class="form-group">
                        <label for="edit-document-category">Category *</label>
                        <select id="edit-document-category" class="form-control" required>
                            <option value="">Select Category</option>
                            <option value="ID">ID Card</option>
                            <option value="Passport">Passport</option>
                            <option value="Driver's License">Driver's License</option>
                            <option value="Education">Education</option>
                            <option value="Vehicle">Vehicle</option>
                            <option value="Office">Office</option>
                            <option value="Insurance">Insurance</option>
                            <option value="Medical">Medical</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="edit-expiry-date">Expiry Date *</label>
                        <input type="date" id="edit-expiry-date" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="edit-reminder-date">Reminder Date *</label>
                        <input type="date" id="edit-reminder-date" class="form-control" required>
                        <small style="color: var(--gray); margin-top: 5px; display: block;">You'll be notified on this
                            date</small>
                    </div>

                    <div class="form-group">
                        <label>Upload New Document Image (Optional)</label>
                        <div class="file-upload-area" id="edit-file-upload-area">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload or drag and drop</p>
                            <p>PNG, JPG, JPEG up to 5MB</p>
                            <div class="file-name" id="edit-file-name">No file selected</div>
                            <img id="edit-image-preview" class="preview-image" src="" alt="Preview">
                            <input type="file" id="edit-document-image" accept="image/*" style="display: none;">
                        </div>
                        <!-- Upload Progress Bar -->
                        <div class="progress-container" id="edit-upload-progress">
                            <div class="progress-bar" id="edit-progress-bar"></div>
                        </div>
                        <small style="color: var(--gray); margin-top: 5px; display: block;">Leave empty to keep current
                            image</small>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn btn-full" id="update-document-btn">
                            <i class="fas fa-save"></i>
                            <span>Update Document</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Document Modal -->
    <div id="view-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="view-document-title">Document Details</h2>
                <button class="close-modal" id="close-view-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <img id="fullscreen-image" src="" alt="Document"
                    onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgZmlsbD0iI2Y4ZjlmYSIvPjx0ZXh0IHg9IjEwMCIgeT0iNzUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2RjZGNkYyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIE5vdCBMb2FkZWQ8L3RleHQ+PC9zdmc+'">
                <div id="document-details">
                    <!-- Document details will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Application -->
    <script>
        // Main Application
        document.addEventListener('DOMContentLoaded', function () {
            /*****************************************************************
             * FIREBASE INTEGRATION - TWO PROJECT ARCHITECTURE
             *****************************************************************/

            // Firebase modules from window.firebaseModules
            const { auth, db, storage, firebaseConfigs } = window.firebaseModules;
            const { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, deleteUser, updatePassword, reauthenticateWithCredential, EmailAuthProvider } = window.firebaseModules.authMethods;
            const { collection, addDoc, query, where, getDocs, deleteDoc, doc, Timestamp, orderBy, writeBatch, updateDoc } = window.firebaseModules.firestoreMethods;
            const { ref, uploadBytes, getDownloadURL, deleteObject, listAll } = window.firebaseModules.storageMethods;

            // DOM Elements
            const authContainer = document.getElementById('auth-container');
            const appContainer = document.getElementById('app-container');
            const signupForm = document.getElementById('signup-form');
            const loginForm = document.getElementById('login-form');
            const showLoginLink = document.getElementById('show-login');
            const showSignupLink = document.getElementById('show-signup');
            const errorMessage = document.getElementById('error-message');
            const successMessage = document.getElementById('success-message');
            const userAvatar = document.getElementById('user-avatar');
            const addDocumentBtn = document.getElementById('add-document-btn');
            const addFirstDocumentBtn = document.getElementById('add-first-document');
            const uploadModal = document.getElementById('upload-modal');
            const closeUploadModal = document.getElementById('close-upload-modal');
            const fileUploadArea = document.getElementById('file-upload-area');
            const documentImageInput = document.getElementById('document-image');
            const fileName = document.getElementById('file-name');
            const imagePreview = document.getElementById('image-preview');
            const documentUploadForm = document.getElementById('document-upload-form');
            const documentsGrid = document.getElementById('documents-grid');
            const emptyState = document.getElementById('empty-state');
            const loadingSpinner = document.getElementById('loading-spinner');
            const notificationBanner = document.getElementById('notification-banner');
            const closeNotificationBtn = document.getElementById('close-notification');
            const expiringCount = document.getElementById('expiring-count');
            const activeCount = document.getElementById('active-count');
            const expiringCountStat = document.getElementById('expiring-count-stat');
            const expiredCount = document.getElementById('expired-count');
            const viewModal = document.getElementById('view-modal');
            const closeViewModal = document.getElementById('close-view-modal');
            const fullscreenImage = document.getElementById('fullscreen-image');
            const viewDocumentTitle = document.getElementById('view-document-title');
            const documentDetails = document.getElementById('document-details');
            const notificationText = document.getElementById('notification-text');
            const uploadProgress = document.getElementById('upload-progress');
            const progressBar = document.getElementById('progress-bar');
            const dashboardView = document.getElementById('dashboard-view');
            const profileView = document.getElementById('profile-view');
            const profileAvatar = document.getElementById('profile-avatar');
            const profileEmail = document.getElementById('profile-email');
            const profileJoinDate = document.getElementById('profile-join-date');
            const profileTotalDocs = document.getElementById('profile-total-docs');
            const profileActiveDocs = document.getElementById('profile-active-docs');
            const profileExpiringDocs = document.getElementById('profile-expiring-docs');
            const profileExpiredDocs = document.getElementById('profile-expired-docs');
            const deleteAccountBtn = document.getElementById('delete-account-btn');
            const toastContainer = document.getElementById('toast-container');
            const themeToggleInput = document.getElementById('theme-toggle-input');
            const signupBtn = document.getElementById('signup-btn');
            const loginBtn = document.getElementById('login-btn');
            const desktopLogoutBtn = document.getElementById('desktop-logout-btn');
            const mobileLogoutBtn = document.getElementById('mobile-logout-btn');

            // New elements for password change and edit functionality
            const changePasswordForm = document.getElementById('change-password-form');
            const changePasswordBtn = document.getElementById('change-password-btn');
            const editModal = document.getElementById('edit-modal');
            const closeEditModal = document.getElementById('close-edit-modal');
            const documentEditForm = document.getElementById('document-edit-form');
            const updateDocumentBtn = document.getElementById('update-document-btn');
            const editFileUploadArea = document.getElementById('edit-file-upload-area');
            const editDocumentImageInput = document.getElementById('edit-document-image');
            const editFileName = document.getElementById('edit-file-name');
            const editImagePreview = document.getElementById('edit-image-preview');

            // Navigation elements
            const desktopNavItems = document.querySelectorAll('.desktop-nav-item');
            const mobileNavItems = document.querySelectorAll('.nav-item');

            // Current user and documents
            let currentUser = null;
            let userDocuments = [];
            let isUploading = false;
            let isUpdating = false;
            let currentView = 'dashboard';
            let currentEditingDocument = null;

            // Firebase configs
            const firebaseConfigProjectA = firebaseConfigs.projectA;
            const firebaseConfigProjectB = firebaseConfigs.projectB;

            // User-friendly error messages
            const errorMessages = {
                'auth/email-already-in-use': 'This email is already registered. Please use a different email or login.',
                'auth/invalid-email': 'Please enter a valid email address.',
                'auth/user-not-found': 'No account found with this email address.',
                'auth/wrong-password': 'Incorrect password. Please try again.',
                'auth/weak-password': 'Password should be at least 6 characters long.',
                'auth/too-many-requests': 'Too many failed attempts. Please try again later.',
                'auth/network-request-failed': 'Network error. Please check your internet connection.',
                'auth/user-disabled': 'This account has been disabled. Please contact support.',
                'auth/requires-recent-login': 'Please re-authenticate to change your password.',
                'storage/unauthorized': 'You are not authorized to upload files.',
                'storage/canceled': 'Upload was canceled.',
                'storage/unknown': 'An unknown error occurred during upload.',
                'firestore/permission-denied': 'You do not have permission to perform this action.'
            };

            // Theme Management
            function initTheme() {
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                themeToggleInput.checked = savedTheme === 'dark';
            }

            function toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                showToast(`Switched to ${newTheme} theme`, 'success');
            }

            // Theme toggle event
            themeToggleInput.addEventListener('change', toggleTheme);

            // Button Loading State Management - IMPROVED VERSION
            function setButtonLoading(button, isLoading) {
                if (isLoading) {
                    button.classList.add('btn-loading');
                    button.disabled = true;
                    // Store original content
                    const span = button.querySelector('span');
                    if (span) {
                        button.dataset.originalContent = span.textContent;
                        span.textContent = 'Loading...';
                    }
                    // Store original icon
                    const icon = button.querySelector('i');
                    if (icon) {
                        button.dataset.originalIcon = icon.className;
                        icon.style.display = 'none';
                    }
                } else {
                    button.classList.remove('btn-loading');
                    button.disabled = false;
                    // Restore original content
                    const span = button.querySelector('span');
                    if (span && button.dataset.originalContent) {
                        span.textContent = button.dataset.originalContent;
                        delete button.dataset.originalContent;
                    }
                    // Restore original icon
                    const icon = button.querySelector('i');
                    if (icon && button.dataset.originalIcon) {
                        icon.className = button.dataset.originalIcon;
                        icon.style.display = 'inline-block';
                        delete button.dataset.originalIcon;
                    }
                }
            }

            // Reset all button loading states
            function resetAllButtonLoading() {
                const buttons = [signupBtn, loginBtn, desktopLogoutBtn, mobileLogoutBtn, changePasswordBtn, updateDocumentBtn];
                buttons.forEach(btn => {
                    if (btn) {
                        setButtonLoading(btn, false);
                    }
                });
            }

            // Show toast notification
            function showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast-notification`;

                const iconClass = type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'success';
                const icon = type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'check-circle';

                toast.innerHTML = `
                    <div class="toast-icon ${iconClass}">
                        <i class="fas fa-${icon}"></i>
                    </div>
                    <div class="toast-content">
                        <p>${message}</p>
                    </div>
                    <button class="toast-close">
                        <i class="fas fa-times"></i>
                    </button>
                `;

                toastContainer.appendChild(toast);

                // Show toast
                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);

                // Close button
                toast.querySelector('.toast-close').addEventListener('click', () => {
                    hideToast(toast);
                });

                // Auto hide after 5 seconds
                setTimeout(() => {
                    hideToast(toast);
                }, 5000);

                function hideToast(toastElement) {
                    toastElement.classList.remove('show');
                    setTimeout(() => {
                        if (toastElement.parentNode) {
                            toastElement.parentNode.removeChild(toastElement);
                        }
                    }, 400);
                }
            }

            // Get user-friendly error message
            function getUserFriendlyError(error) {
                const code = error.code || error;
                return errorMessages[code] || 'An error occurred. Please try again.';
            }

            // Toggle between signup and login forms
            showLoginLink.addEventListener('click', function (e) {
                e.preventDefault();
                signupForm.style.display = 'none';
                loginForm.style.display = 'block';
                clearMessages();
                resetAllButtonLoading();
            });

            showSignupLink.addEventListener('click', function (e) {
                e.preventDefault();
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
                clearMessages();
                resetAllButtonLoading();
            });

            // Clear error/success messages
            function clearMessages() {
                errorMessage.style.display = 'none';
                successMessage.style.display = 'none';
            }

            // Show error message
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
            }

            // Show success message
            function showSuccess(message) {
                successMessage.textContent = message;
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
            }

            // Handle signup with Firebase Authentication
            signupForm.addEventListener('submit', async function (e) {
                e.preventDefault();

                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm-password').value;

                // Validate passwords match
                if (password !== confirmPassword) {
                    showError('Passwords do not match');
                    return;
                }

                // Validate password length
                if (password.length < 6) {
                    showError('Password must be at least 6 characters long');
                    return;
                }

                try {
                    // Set button loading state
                    setButtonLoading(signupBtn, true);

                    // Create user with Firebase Authentication (Project A)
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    currentUser = userCredential.user;

                    showSuccess('Account created successfully! Please login.');

                    // Switch to login form after a delay
                    setTimeout(() => {
                        signupForm.style.display = 'none';
                        loginForm.style.display = 'block';
                        signupForm.reset();
                        clearMessages();
                        setButtonLoading(signupBtn, false);
                    }, 1500);

                } catch (error) {
                    console.error('Signup error:', error);
                    showError(getUserFriendlyError(error));
                    setButtonLoading(signupBtn, false);
                }
            });

            // Handle login with Firebase Authentication
            loginForm.addEventListener('submit', async function (e) {
                e.preventDefault();

                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;

                try {
                    // Set button loading state
                    setButtonLoading(loginBtn, true);

                    // Sign in user with Firebase Authentication (Project A)
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    currentUser = userCredential.user;

                    // Show app and hide auth screen
                    authContainer.style.display = 'none';
                    appContainer.style.display = 'block';

                    // Reset button loading state
                    setButtonLoading(loginBtn, false);

                    // Update user avatar
                    updateUserAvatar();

                    // Load user documents from Firestore
                    loadUserDocuments();

                } catch (error) {
                    console.error('Login error:', error);
                    showError(getUserFriendlyError(error));
                    setButtonLoading(loginBtn, false);
                }
            });

            // Handle logout - Combined for both desktop and mobile
            function handleLogout() {
                return async function () {
                    try {
                        setButtonLoading(this, true);
                        await signOut(auth);
                        currentUser = null;
                        userDocuments = [];

                        // Show auth and hide app
                        authContainer.style.display = 'flex';
                        appContainer.style.display = 'none';

                        // Reset forms
                        signupForm.reset();
                        loginForm.reset();
                        clearMessages();

                        // Show login form
                        signupForm.style.display = 'none';
                        loginForm.style.display = 'block';

                        // Reset view to dashboard
                        switchView('dashboard');

                        // Reset button loading
                        setButtonLoading(this, false);

                    } catch (error) {
                        console.error('Logout error:', error);
                        showToast('Error logging out: ' + getUserFriendlyError(error), 'error');
                        setButtonLoading(this, false);
                    }
                };
            }

            desktopLogoutBtn.addEventListener('click', handleLogout());
            mobileLogoutBtn.addEventListener('click', handleLogout());

            // Update user avatar with initial
            function updateUserAvatar() {
                if (currentUser && currentUser.email) {
                    const initial = currentUser.email.charAt(0).toUpperCase();
                    userAvatar.textContent = initial;
                    profileAvatar.textContent = initial;
                    profileEmail.textContent = currentUser.email;

                    // Set join date
                    if (currentUser.metadata && currentUser.metadata.creationTime) {
                        const joinDate = new Date(currentUser.metadata.creationTime).toLocaleDateString('en-US', {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                        profileJoinDate.textContent = `Joined on ${joinDate}`;
                    }
                }
            }

            // Check authentication state
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User is signed in
                    currentUser = user;
                    authContainer.style.display = 'none';
                    appContainer.style.display = 'block';
                    updateUserAvatar();
                    loadUserDocuments();
                } else {
                    // User is signed out
                    currentUser = null;
                    // Reset all button loading states when user signs out
                    resetAllButtonLoading();
                }
            });

            // Open upload modal
            addDocumentBtn.addEventListener('click', openUploadModal);
            addFirstDocumentBtn.addEventListener('click', openUploadModal);

            function openUploadModal() {
                uploadModal.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevent scrolling

                // Set minimum dates for expiry and reminder
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('expiry-date').min = today;
                document.getElementById('reminder-date').min = today;

                // Initialize default dates
                initializeDateInputs();
            }

            // Close upload modal
            closeUploadModal.addEventListener('click', function () {
                closeModal(uploadModal);
            });

            // Close view modal
            closeViewModal.addEventListener('click', function () {
                closeModal(viewModal);
            });

            // Close edit modal
            closeEditModal.addEventListener('click', function () {
                closeModal(editModal);
            });

            // Generic close modal function
            function closeModal(modal) {
                modal.classList.remove('active');
                document.body.style.overflow = ''; // Restore scrolling

                // Reset form if it's upload modal
                if (modal === uploadModal) {
                    resetUploadForm();
                } else if (modal === editModal) {
                    resetEditForm();
                }
            }

            // Click on file upload area to trigger file input
            fileUploadArea.addEventListener('click', function () {
                documentImageInput.click();
            });

            editFileUploadArea.addEventListener('click', function () {
                editDocumentImageInput.click();
            });

            // Drag and drop functionality for upload modal
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                fileUploadArea.addEventListener(eventName, preventDefaults, false);
                editFileUploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                fileUploadArea.addEventListener(eventName, highlight, false);
                editFileUploadArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                fileUploadArea.addEventListener(eventName, unhighlight, false);
                editFileUploadArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                e.currentTarget.classList.add('drag-over');
            }

            function unhighlight(e) {
                e.currentTarget.classList.remove('drag-over');
            }

            // Handle file drop
            fileUploadArea.addEventListener('drop', handleDrop.bind(null, 'upload'), false);
            editFileUploadArea.addEventListener('drop', handleDrop.bind(null, 'edit'), false);

            function handleDrop(type, e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                if (files.length > 0) {
                    if (type === 'upload') {
                        handleFiles(files, 'upload');
                    } else {
                        handleFiles(files, 'edit');
                    }
                }
            }

            // Handle file selection
            documentImageInput.addEventListener('change', function (e) {
                handleFiles(e.target.files, 'upload');
            });

            editDocumentImageInput.addEventListener('change', function (e) {
                handleFiles(e.target.files, 'edit');
            });

            function handleFiles(files, type) {
                const file = files[0];

                if (file) {
                    // Validate file type
                    if (!file.type.match('image.*')) {
                        showToast('Please select an image file (JPG, PNG, etc.)', 'error');
                        return;
                    }

                    // Validate file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        showToast('File size exceeds 5MB limit', 'error');
                        return;
                    }

                    if (type === 'upload') {
                        fileName.textContent = file.name;

                        // Preview image
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            imagePreview.src = e.target.result;
                            imagePreview.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        editFileName.textContent = file.name;

                        // Preview image
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            editImagePreview.src = e.target.result;
                            editImagePreview.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                }
            }

            // Reset upload form
            function resetUploadForm() {
                documentUploadForm.reset();
                fileName.textContent = 'No file selected';
                imagePreview.src = '';
                imagePreview.style.display = 'none';
                uploadProgress.style.display = 'none';
                progressBar.style.width = '0%';
                isUploading = false;
                initializeDateInputs();

                // Reset button
                const uploadBtn = document.getElementById('upload-document-btn');
                setButtonLoading(uploadBtn, false);
            }

            // Reset edit form
            function resetEditForm() {
                documentEditForm.reset();
                editFileName.textContent = 'No file selected';
                editImagePreview.src = '';
                editImagePreview.style.display = 'none';
                document.getElementById('edit-upload-progress').style.display = 'none';
                document.getElementById('edit-progress-bar').style.width = '0%';
                isUpdating = false;
                currentEditingDocument = null;

                // Reset button
                setButtonLoading(updateDocumentBtn, false);
            }

            // Handle document upload
            documentUploadForm.addEventListener('submit', async function (e) {
                e.preventDefault();

                if (!currentUser) {
                    showToast('Please sign in to upload documents', 'error');
                    return;
                }

                if (isUploading) {
                    showToast('Upload already in progress', 'warning');
                    return;
                }

                const title = document.getElementById('document-title').value.trim();
                const category = document.getElementById('document-category').value;
                const expiryDate = document.getElementById('expiry-date').value;
                const reminderDate = document.getElementById('reminder-date').value;
                const imageFile = documentImageInput.files[0];

                // Validate form
                if (!title) {
                    showToast('Please enter a document title', 'error');
                    return;
                }

                if (!category) {
                    showToast('Please select a category', 'error');
                    return;
                }

                // Validate dates
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                const expiry = new Date(expiryDate);
                expiry.setHours(0, 0, 0, 0);

                const reminder = new Date(reminderDate);
                reminder.setHours(0, 0, 0, 0);

                if (expiry < today) {
                    showToast('Expiry date cannot be in the past', 'error');
                    return;
                }

                if (reminder > expiry) {
                    showToast('Reminder date cannot be after expiry date', 'error');
                    return;
                }

                if (!imageFile) {
                    showToast('Please select an image to upload', 'error');
                    return;
                }

                isUploading = true;

                try {
                    // Show loading state
                    const uploadBtn = document.getElementById('upload-document-btn');
                    setButtonLoading(uploadBtn, true);

                    // Show progress bar
                    uploadProgress.style.display = 'block';
                    progressBar.style.width = '10%';

                    /*****************************************************************
                     * STEP 1: UPLOAD IMAGE TO PROJECT B STORAGE
                     *****************************************************************/
                    const userId = currentUser.uid;
                    const timestamp = Date.now();
                    const fileExtension = imageFile.name.split('.').pop();
                    const imageName = `${timestamp}_${Math.random().toString(36).substring(7)}.${fileExtension}`;
                    const storagePath = `identityWallet/users/${userId}/images/${imageName}`;

                    // Create storage reference (Project B)
                    const storageRef = ref(storage, storagePath);

                    // Create metadata for the image
                    const metadata = {
                        contentType: imageFile.type,
                        customMetadata: {
                            uploadedBy: userId,
                            documentTitle: title,
                            uploadedAt: timestamp.toString()
                        }
                    };

                    // Upload image to Firebase Storage
                    await uploadBytes(storageRef, imageFile, metadata);

                    // Update progress
                    progressBar.style.width = '60%';

                    /*****************************************************************
                     * STEP 2: GET DOWNLOAD URL FROM STORAGE
                     *****************************************************************/
                    const downloadURL = await getDownloadURL(storageRef);

                    // Update progress
                    progressBar.style.width = '80%';

                    /*****************************************************************
                     * STEP 3: SAVE METADATA TO PROJECT A FIRESTORE
                     *****************************************************************/
                    const documentData = {
                        documentTitle: title,
                        category: category,
                        expiryDate: expiryDate,
                        reminderDate: reminderDate,
                        createdAt: Timestamp.now(),
                        imageURL: downloadURL, // URL from Project B Storage
                        userId: userId,
                        storagePath: storagePath, // Store storage path for deletion
                        status: 'active'
                    };

                    // Save to Firestore with proper path structure
                    const userDocumentsRef = collection(db, 'users', userId, 'documents');
                    await addDoc(userDocumentsRef, documentData);

                    // Update progress
                    progressBar.style.width = '100%';

                    // Success
                    setTimeout(() => {
                        closeModal(uploadModal);
                        showToast('Document uploaded successfully!', 'success');
                        loadUserDocuments();
                    }, 500);

                } catch (error) {
                    console.error('Error uploading document:', error);
                    showToast('Error uploading document: ' + getUserFriendlyError(error), 'error');
                } finally {
                    isUploading = false;
                    const uploadBtn = document.getElementById('upload-document-btn');
                    setButtonLoading(uploadBtn, false);
                }
            });

            /*****************************************************************
             * LOAD USER DOCUMENTS FROM FIRESTORE (Project A)
             *****************************************************************/
            async function loadUserDocuments() {
                if (!currentUser) return;

                try {
                    loadingSpinner.style.display = 'block';
                    documentsGrid.innerHTML = '';

                    // Query Firestore for user's documents
                    const userId = currentUser.uid;
                    const userDocumentsRef = collection(db, 'users', userId, 'documents');

                    // Order by creation date, newest first
                    const q = query(userDocumentsRef, orderBy('createdAt', 'desc'));
                    const querySnapshot = await getDocs(q);

                    userDocuments = [];
                    let activeDocs = 0;
                    let expiringDocs = 0;
                    let expiredDocs = 0;
                    let hasExpiringDocs = false;

                    // Clear previous documents
                    userDocuments = [];

                    querySnapshot.forEach((docSnapshot) => {
                        const documentData = docSnapshot.data();
                        documentData.id = docSnapshot.id; // Add document ID

                        // Calculate document status based on dates
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);

                        const expiryDate = new Date(documentData.expiryDate);
                        expiryDate.setHours(0, 0, 0, 0);

                        const reminderDate = new Date(documentData.reminderDate);
                        reminderDate.setHours(0, 0, 0, 0);

                        let status = 'active';
                        if (today > expiryDate) {
                            status = 'expired';
                            expiredDocs++;
                        } else if (today >= reminderDate) {
                            status = 'expiring';
                            expiringDocs++;
                            hasExpiringDocs = true;
                        } else {
                            activeDocs++;
                        }

                        documentData.status = status;
                        userDocuments.push(documentData);
                    });

                    // Remove duplicates by ID
                    const uniqueDocs = [];
                    const seenIds = new Set();

                    userDocuments.forEach(doc => {
                        if (!seenIds.has(doc.id)) {
                            seenIds.add(doc.id);
                            uniqueDocs.push(doc);
                        }
                    });

                    userDocuments = uniqueDocs;

                    // Render documents based on current view
                    renderDocuments();

                    // Update stats
                    activeCount.textContent = activeDocs;
                    expiringCountStat.textContent = expiringDocs;
                    expiredCount.textContent = expiredDocs;
                    expiringCount.textContent = expiringDocs;

                    // Update profile stats
                    profileTotalDocs.textContent = userDocuments.length;
                    profileActiveDocs.textContent = activeDocs;
                    profileExpiringDocs.textContent = expiringDocs;
                    profileExpiredDocs.textContent = expiredDocs;

                    // Show/hide empty state
                    if (userDocuments.length === 0) {
                        emptyState.style.display = 'block';
                        documentsGrid.style.display = 'none';
                    } else {
                        emptyState.style.display = 'none';
                        documentsGrid.style.display = 'grid';
                    }

                    // Show notification banner if there are expiring documents
                    if (hasExpiringDocs) {
                        notificationText.innerHTML = `You have <span id="expiring-count">${expiringDocs}</span> document${expiringDocs > 1 ? 's' : ''} expiring soon. Check them now!`;
                        notificationBanner.style.display = 'flex';
                    } else {
                        notificationBanner.style.display = 'none';
                    }

                } catch (error) {
                    console.error('Error loading documents:', error);
                    showToast('Error loading documents: ' + getUserFriendlyError(error), 'error');
                } finally {
                    loadingSpinner.style.display = 'none';
                }
            }

            // Render documents based on current view
            function renderDocuments() {
                documentsGrid.innerHTML = '';

                let filteredDocs = userDocuments;

                if (currentView === 'expiring') {
                    filteredDocs = userDocuments.filter(doc => doc.status === 'expiring');
                }

                filteredDocs.forEach(documentData => {
                    createDocumentCard(documentData);
                });
            }

            // Create document card element
            function createDocumentCard(documentData) {
                const card = document.createElement('div');
                card.className = `document-card ${documentData.status}`;
                card.dataset.id = documentData.id;

                // Format dates
                const uploadDate = documentData.createdAt.toDate().toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });

                const expiryDate = new Date(documentData.expiryDate).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });

                const reminderDate = new Date(documentData.reminderDate).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });

                // Status text and class
                let statusText = 'Active';
                let statusClass = 'status-active';

                if (documentData.status === 'expiring') {
                    statusText = 'Expiring Soon';
                    statusClass = 'status-expiring';
                } else if (documentData.status === 'expired') {
                    statusText = 'Expired';
                    statusClass = 'status-expired';
                }

                card.innerHTML = `
                    <div class="document-image" data-id="${documentData.id}">
                        <img src="${documentData.imageURL}" alt="${documentData.documentTitle}" loading="lazy" 
                             onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgZmlsbD0iI2Y4ZjlmYSIvPjx0ZXh0IHg9IjEwMCIgeT0iNzUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2RjZGNkYyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIE5vdCBMb2FkZWQ8L3RleHQ+PC9zdmc+'">
                    </div>
                    <div class="document-info">
                        <div class="document-header">
                            <div>
                                <div class="document-title">${documentData.documentTitle}</div>
                                <span class="document-category">${documentData.category}</span>
                            </div>
                            <span class="document-status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="document-dates">
                            <div class="date-item">
                                <span class="date-label">Uploaded:</span>
                                <span class="date-value">${uploadDate}</span>
                            </div>
                            <div class="date-item">
                                <span class="date-label">Expires:</span>
                                <span class="date-value">${expiryDate}</span>
                            </div>
                            <div class="date-item">
                                <span class="date-label">Reminder:</span>
                                <span class="date-value">${reminderDate}</span>
                            </div>
                        </div>
                    </div>
                    <div class="document-actions">
                        <button class="action-btn edit-document" data-id="${documentData.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="action-btn view-document" data-id="${documentData.id}">
                            <i class="fas fa-expand"></i> View
                        </button>
                        <button class="action-btn delete-document" data-id="${documentData.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;

                documentsGrid.appendChild(card);

                // Add event listeners to buttons
                const editBtn = card.querySelector('.edit-document');
                const viewBtn = card.querySelector('.view-document');
                const deleteBtn = card.querySelector('.delete-document');
                const imageArea = card.querySelector('.document-image');

                editBtn.addEventListener('click', function () {
                    editDocument(documentData);
                });

                viewBtn.addEventListener('click', function () {
                    viewDocument(documentData);
                });

                deleteBtn.addEventListener('click', function () {
                    deleteDocument(documentData.id, documentData.storagePath, documentData.documentTitle);
                });

                // Make the entire image area clickable for viewing
                imageArea.addEventListener('click', function () {
                    viewDocument(documentData);
                });
            }

            // Edit document functionality
            function editDocument(documentData) {
                currentEditingDocument = documentData;

                // Fill the form with existing data
                document.getElementById('edit-document-id').value = documentData.id;
                document.getElementById('edit-document-storage-path').value = documentData.storagePath || '';
                document.getElementById('edit-document-title').value = documentData.documentTitle;
                document.getElementById('edit-document-category').value = documentData.category;
                document.getElementById('edit-expiry-date').value = documentData.expiryDate;
                document.getElementById('edit-reminder-date').value = documentData.reminderDate;

                // Show current image preview
                editImagePreview.src = documentData.imageURL;
                editImagePreview.style.display = 'block';
                editFileName.textContent = 'Current image';

                // Set minimum dates
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('edit-expiry-date').min = today;
                document.getElementById('edit-reminder-date').min = today;

                // Open modal
                editModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            // Handle document update
            documentEditForm.addEventListener('submit', async function (e) {
                e.preventDefault();

                if (!currentUser || !currentEditingDocument) {
                    showToast('Cannot update document', 'error');
                    return;
                }

                if (isUpdating) {
                    showToast('Update already in progress', 'warning');
                    return;
                }

                const documentId = document.getElementById('edit-document-id').value;
                const storagePath = document.getElementById('edit-document-storage-path').value;
                const title = document.getElementById('edit-document-title').value.trim();
                const category = document.getElementById('edit-document-category').value;
                const expiryDate = document.getElementById('edit-expiry-date').value;
                const reminderDate = document.getElementById('edit-reminder-date').value;
                const imageFile = editDocumentImageInput.files[0];

                // Validate form
                if (!title) {
                    showToast('Please enter a document title', 'error');
                    return;
                }

                if (!category) {
                    showToast('Please select a category', 'error');
                    return;
                }

                // Validate dates
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                const expiry = new Date(expiryDate);
                expiry.setHours(0, 0, 0, 0);

                const reminder = new Date(reminderDate);
                reminder.setHours(0, 0, 0, 0);

                if (expiry < today) {
                    showToast('Expiry date cannot be in the past', 'error');
                    return;
                }

                if (reminder > expiry) {
                    showToast('Reminder date cannot be after expiry date', 'error');
                    return;
                }

                isUpdating = true;

                try {
                    // Show loading state
                    setButtonLoading(updateDocumentBtn, true);

                    // Show progress bar
                    const editProgress = document.getElementById('edit-upload-progress');
                    const editProgressBar = document.getElementById('edit-progress-bar');
                    editProgress.style.display = 'block';
                    editProgressBar.style.width = '10%';

                    let downloadURL = currentEditingDocument.imageURL;
                    let newStoragePath = storagePath;

                    // If a new image is uploaded, upload it to storage
                    if (imageFile) {
                        editProgressBar.style.width = '30%';

                        const userId = currentUser.uid;
                        const timestamp = Date.now();
                        const fileExtension = imageFile.name.split('.').pop();
                        const imageName = `${timestamp}_${Math.random().toString(36).substring(7)}.${fileExtension}`;
                        newStoragePath = `identityWallet/users/${userId}/images/${imageName}`;

                        // Create storage reference (Project B)
                        const storageRef = ref(storage, newStoragePath);

                        // Create metadata for the image
                        const metadata = {
                            contentType: imageFile.type,
                            customMetadata: {
                                uploadedBy: userId,
                                documentTitle: title,
                                uploadedAt: timestamp.toString(),
                                updatedAt: timestamp.toString()
                            }
                        };

                        // Upload new image to Firebase Storage
                        await uploadBytes(storageRef, imageFile, metadata);
                        editProgressBar.style.width = '60%';

                        // Get download URL
                        downloadURL = await getDownloadURL(storageRef);
                        editProgressBar.style.width = '80%';

                        // Delete old image from storage if it exists and is different
                        if (storagePath && storagePath !== newStoragePath) {
                            try {
                                const oldStorageRef = ref(storage, storagePath);
                                await deleteObject(oldStorageRef);
                            } catch (storageError) {
                                console.warn('Could not delete old storage file:', storageError);
                                // Continue even if old file deletion fails
                            }
                        }
                    }

                    editProgressBar.style.width = '90%';

                    // Update document in Firestore
                    const userId = currentUser.uid;
                    const documentRef = doc(db, 'users', userId, 'documents', documentId);

                    const updateData = {
                        documentTitle: title,
                        category: category,
                        expiryDate: expiryDate,
                        reminderDate: reminderDate,
                        imageURL: downloadURL,
                        storagePath: newStoragePath
                    };

                    await updateDoc(documentRef, updateData);
                    editProgressBar.style.width = '100%';

                    // Success
                    setTimeout(() => {
                        closeModal(editModal);
                        showToast('Document updated successfully!', 'success');
                        loadUserDocuments();
                    }, 500);

                } catch (error) {
                    console.error('Error updating document:', error);
                    showToast('Error updating document: ' + getUserFriendlyError(error), 'error');
                } finally {
                    isUpdating = false;
                    setButtonLoading(updateDocumentBtn, false);
                }
            });

            // View document in full screen
            function viewDocument(documentData) {
                if (!documentData) {
                    console.error('No document data provided');
                    showToast('Error: Could not load document', 'error');
                    return;
                }

                try {
                    // Format dates for display
                    const uploadDate = documentData.createdAt.toDate().toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });

                    const expiryDate = new Date(documentData.expiryDate).toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });

                    const reminderDate = new Date(documentData.reminderDate).toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });

                    // Status text
                    let statusText = 'Active';
                    let statusClass = 'status-active';

                    if (documentData.status === 'expiring') {
                        statusText = 'Expiring Soon';
                        statusClass = 'status-expiring';
                    } else if (documentData.status === 'expired') {
                        statusText = 'Expired';
                        statusClass = 'status-expired';
                    }

                    // Set modal content
                    viewDocumentTitle.textContent = documentData.documentTitle;
                    fullscreenImage.src = documentData.imageURL;
                    fullscreenImage.alt = documentData.documentTitle;

                    documentDetails.innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <h3 style="margin-bottom: 10px; color: var(--dark);">Document Details</h3>
                            <div class="date-item">
                                <span class="date-label">Title:</span>
                                <span class="date-value">${documentData.documentTitle}</span>
                            </div>
                            <div class="date-item">
                                <span class="date-label">Category:</span>
                                <span class="date-value">${documentData.category}</span>
                            </div>
                            <div class="date-item">
                                <span class="date-label">Status:</span>
                                <span class="date-value ${statusClass}" style="display: inline-block; padding: 2px 8px; border-radius: 12px;">${statusText}</span>
                            </div>
                        </div>
                        <div>
                            <h3 style="margin-bottom: 10px; color: var(--dark);">Dates</h3>
                            <div class="date-item">
                                <span class="date-label">Uploaded:</span>
                                <span class="date-value">${uploadDate}</span>
                            </div>
                            <div class="date-item">
                                <span class="date-label">Expiry Date:</span>
                                <span class="date-value">${expiryDate}</span>
                            </div>
                            <div class="date-item">
                                <span class="date-label">Reminder Date:</span>
                                <span class="date-value">${reminderDate}</span>
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background-color: var(--light); border-radius: 8px;">
                            <p style="font-size: 14px; color: var(--gray); margin-bottom: 5px;"><strong>Note:</strong> Images are stored securely in Firebase Cloud Storage</p>
                        </div>
                    `;

                    // Show modal
                    viewModal.classList.add('active');
                    document.body.style.overflow = 'hidden';

                } catch (error) {
                    console.error('Error viewing document:', error);
                    showToast('Error loading document details', 'error');
                }
            }

            /*****************************************************************
             * DELETE DOCUMENT FROM FIRESTORE AND STORAGE
             *****************************************************************/
            async function deleteDocument(documentId, storagePath, documentTitle) {
                if (!confirm(`Are you sure you want to delete "${documentTitle}"? This action cannot be undone.`)) {
                    return;
                }

                if (!currentUser) return;

                try {
                    const userId = currentUser.uid;

                    // Delete document from Firestore (Project A)
                    const documentRef = doc(db, 'users', userId, 'documents', documentId);
                    await deleteDoc(documentRef);

                    // Delete image from Storage (Project B) if storagePath exists
                    if (storagePath) {
                        try {
                            const storageRef = ref(storage, storagePath);
                            await deleteObject(storageRef);
                            console.log('Storage file deleted:', storagePath);
                        } catch (storageError) {
                            console.warn('Could not delete storage file:', storageError);
                            // Continue even if storage deletion fails
                        }
                    }

                    // Remove from UI with animation
                    const card = document.querySelector(`.document-card[data-id="${documentId}"]`);
                    if (card) {
                        card.classList.add('fade-out');
                        setTimeout(() => {
                            if (card.parentNode) {
                                card.parentNode.removeChild(card);
                            }
                        }, 300);
                    }

                    // Remove from userDocuments array
                    userDocuments = userDocuments.filter(doc => doc.id !== documentId);

                    // Reload documents to update stats
                    loadUserDocuments();

                    // Show success message
                    showToast('Document deleted successfully!', 'success');

                } catch (error) {
                    console.error('Error deleting document:', error);
                    showToast('Error deleting document: ' + getUserFriendlyError(error), 'error');
                }
            }

            /*****************************************************************
             * CHANGE PASSWORD FUNCTIONALITY
             *****************************************************************/
            changePasswordForm.addEventListener('submit', async function (e) {
                e.preventDefault();

                if (!currentUser) {
                    showToast('Please sign in to change password', 'error');
                    return;
                }

                const currentPassword = document.getElementById('current-password').value;
                const newPassword = document.getElementById('new-password').value;
                const confirmNewPassword = document.getElementById('confirm-new-password').value;

                // Validate passwords
                if (!currentPassword) {
                    showToast('Please enter your current password', 'error');
                    return;
                }

                if (newPassword.length < 6) {
                    showToast('New password must be at least 6 characters long', 'error');
                    return;
                }

                if (newPassword !== confirmNewPassword) {
                    showToast('New passwords do not match', 'error');
                    return;
                }

                if (currentPassword === newPassword) {
                    showToast('New password must be different from current password', 'error');
                    return;
                }

                try {
                    // Set button loading state
                    setButtonLoading(changePasswordBtn, true);

                    // Re-authenticate user
                    const credential = EmailAuthProvider.credential(currentUser.email, currentPassword);
                    await reauthenticateWithCredential(currentUser, credential);

                    // Update password
                    await updatePassword(currentUser, newPassword);

                    // Reset form
                    changePasswordForm.reset();

                    // Show success message
                    showToast('Password updated successfully!', 'success');

                } catch (error) {
                    console.error('Error changing password:', error);
                    showToast('Error changing password: ' + getUserFriendlyError(error), 'error');
                } finally {
                    setButtonLoading(changePasswordBtn, false);
                }
            });

            /*****************************************************************
             * DELETE USER ACCOUNT AND ALL DATA
             *****************************************************************/
            async function deleteUserAccount() {
                if (!currentUser) return;

                if (!confirm('WARNING: This will permanently delete your account and all your documents. This action cannot be undone. Are you absolutely sure?')) {
                    return;
                }

                try {
                    setButtonLoading(deleteAccountBtn, true);

                    const userId = currentUser.uid;

                    // 1. Delete all documents from Firestore
                    const userDocumentsRef = collection(db, 'users', userId, 'documents');
                    const querySnapshot = await getDocs(userDocumentsRef);

                    const batch = writeBatch(db);
                    querySnapshot.forEach((docSnapshot) => {
                        batch.delete(docSnapshot.ref);
                    });
                    await batch.commit();
                    console.log('Firestore documents deleted for user:', userId);

                    // 2. Delete all images from Storage recursively
                    try {
                        // Delete from the user's folder recursively
                        await deleteStorageFolderRecursively(`identityWallet/users/${userId}`);
                        console.log('Storage files deleted for user:', userId);
                    } catch (storageError) {
                        console.warn('Could not delete all storage files:', storageError);
                        // Continue even if storage deletion fails
                    }

                    // 3. Delete user from Authentication
                    await deleteUser(currentUser);
                    console.log('User deleted from Auth:', userId);

                    // 4. Sign out and redirect to login
                    await signOut(auth);

                    showToast('Account deleted successfully. All data has been removed.', 'success');

                    setTimeout(() => {
                        // Show auth and hide app
                        authContainer.style.display = 'flex';
                        appContainer.style.display = 'none';

                        // Reset forms
                        signupForm.reset();
                        loginForm.reset();
                        clearMessages();

                        // Show login form
                        signupForm.style.display = 'none';
                        loginForm.style.display = 'block';

                        // Reset button loading
                        setButtonLoading(deleteAccountBtn, false);
                    }, 1500);

                } catch (error) {
                    console.error('Error deleting account:', error);
                    showToast('Error deleting account: ' + getUserFriendlyError(error), 'error');
                    setButtonLoading(deleteAccountBtn, false);
                }
            }

            // Helper function to delete storage folder recursively
            async function deleteStorageFolderRecursively(folderPath) {
                try {
                    const folderRef = ref(storage, folderPath);

                    // List all items in the folder
                    const listResult = await listAll(folderRef);

                    // Delete all files
                    const deleteFilePromises = listResult.items.map(itemRef =>
                        deleteObject(itemRef).catch(error => {
                            console.warn(`Failed to delete file ${itemRef.fullPath}:`, error);
                        })
                    );

                    // Recursively delete all subfolders
                    const deleteFolderPromises = listResult.prefixes.map(prefixRef =>
                        deleteStorageFolderRecursively(prefixRef.fullPath)
                    );

                    // Wait for all deletions to complete
                    await Promise.all([...deleteFilePromises, ...deleteFolderPromises]);

                    console.log('Folder deleted successfully:', folderPath);
                } catch (error) {
                    console.error('Error deleting folder:', folderPath, error);
                    throw error;
                }
            }

            // Close notification banner
            closeNotificationBtn.addEventListener('click', function () {
                notificationBanner.style.display = 'none';
            });

            // Switch between views
            function switchView(view) {
                currentView = view;

                // Update active nav items
                desktopNavItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.view === view) {
                        item.classList.add('active');
                    }
                });

                mobileNavItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.view === view) {
                        item.classList.add('active');
                    }
                });

                // Show/hide views
                if (view === 'dashboard' || view === 'expiring') {
                    dashboardView.style.display = 'block';
                    profileView.style.display = 'none';

                    // Update dashboard header based on view
                    const header = dashboardView.querySelector('.dashboard-header h1');
                    if (view === 'expiring') {
                        header.textContent = 'Expiring Documents';
                        dashboardView.querySelector('.dashboard-header p').textContent = 'Documents that are expiring soon';
                    } else {
                        header.textContent = 'My Identity Documents';
                        dashboardView.querySelector('.dashboard-header p').textContent = 'Securely store and manage your important documents';
                    }

                    // Render documents for current view
                    renderDocuments();

                } else if (view === 'profile') {
                    dashboardView.style.display = 'none';
                    profileView.style.display = 'block';
                    profileView.classList.add('active');
                }
            }

            // Desktop navigation
            desktopNavItems.forEach(item => {
                item.addEventListener('click', function (e) {
                    e.preventDefault();
                    switchView(this.dataset.view);
                });
            });

            // Mobile navigation (excluding logout button)
            mobileNavItems.forEach(item => {
                if (!item.id.includes('logout')) {
                    item.addEventListener('click', function (e) {
                        e.preventDefault();
                        switchView(this.dataset.view);
                    });
                }
            });

            // Profile avatar click (desktop)
            userAvatar.addEventListener('click', function () {
                switchView('profile');
            });

            // Delete account button
            deleteAccountBtn.addEventListener('click', deleteUserAccount);

            // Initialize date inputs with default values
            function initializeDateInputs() {
                const today = new Date();
                const nextWeek = new Date(today);
                nextWeek.setDate(nextWeek.getDate() + 30);

                const nextMonth = new Date(today);
                nextMonth.setMonth(nextMonth.getMonth() + 6);

                // Format dates for input fields (YYYY-MM-DD)
                const todayStr = today.toISOString().split('T')[0];
                const nextWeekStr = nextWeek.toISOString().split('T')[0];
                const nextMonthStr = nextMonth.toISOString().split('T')[0];

                // Set default dates
                document.getElementById('expiry-date').value = nextMonthStr;
                document.getElementById('reminder-date').value = nextWeekStr;
            }

            // Close modals when clicking outside
            document.addEventListener('click', function (e) {
                if (e.target.classList.contains('modal-overlay')) {
                    closeModal(e.target);
                }
            });

            // Close modals with Escape key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    const modals = document.querySelectorAll('.modal-overlay.active');
                    modals.forEach(modal => closeModal(modal));
                }
            });

            // Initialize the app
            initTheme();
            initializeDateInputs();
            switchView('dashboard');

            // Show Firebase configuration status
            console.log("=== DIGITAL IDENTITY WALLET - FIREBASE VERSION ===");
            console.log("Auth Project:", firebaseConfigProjectA.projectId || "NOT CONFIGURED");
            console.log("Storage Project:", firebaseConfigProjectB.projectId || "NOT CONFIGURED");
            console.log("===============================================");

            // Check if Firebase configs are properly set
            if (firebaseConfigProjectA.apiKey.includes("REPLACE") || firebaseConfigProjectB.apiKey.includes("REPLACE")) {
                console.error("⚠️ WARNING: Firebase configurations not set!");
                console.error("Please replace the firebaseConfig objects with your actual Firebase project configurations.");
            }
        });
    </script>
</body>

</html>
